box: saucisson/lua-testenv
build:
  steps:
    - script:
        name: "Run tests"
        code: |
          for dir in "${root}"/lua*; do
            echo "Installing in ${dir}..."
            "${dir}/bin/luarocks" make rockspec/*-master-1.rockspec
          done
          for dir in "${root}"/lua*; do
            echo "Checking in ${dir}..."
            "${dir}/bin/luacheck" --std=max+busted src/
            echo "Testing in ${dir}..."
            "${dir}/bin/busted" src/
          done

deploy:
  luarocks:
    - script:
        name: Upload to luarocks
        code: |
          ./bin/upload
